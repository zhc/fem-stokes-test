\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{indentfirst}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{ltgray}{rgb}{0.95,0.95,0.95}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\newcommand{\rot}{\mathop{\rm rot}\nolimits}
\renewcommand{\lstlistingname}{Листинг}
\lstset{ %
  language=Python,                % the language of the code
  basicstyle=\footnotesize\ttfamily,           % the size of the fonts that are used for the code
%  numbers=left,                   % where to put the line-numbers
%  numberstyle=\tiny\color{gray},  % the style that is used for the line-numbers
%  stepnumber=2,                   % the step between two line-numbers. If it's 1, each line 
                                  % will be numbered
%  numbersep=5pt,                  % how far the line-numbers are from the code
  backgroundcolor=\color{ltgray},      % choose the background color. You must add \usepackage{color}
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,                 % show tabs within strings adding particular underscores
  %frame=single,                   % adds a frame around the code
  rulecolor=\color{black},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  columns=fixed,
  tabsize=2,                      % sets default tabsize to 2 spaces
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
%  caption=Valalala,                   % show the filename of files included with \lstinputlisting;
                                  % also try caption instead of title
  keywordstyle=\color{blue},          % keyword style
  commentstyle=\color{gray},       % comment style
  stringstyle=\color{dkgreen},         % string literal style
  escapeinside={\%*}{*)},            % if you want to add LaTeX within your code
  morekeywords={*,...},              % if you want to add more keywords to the set
  deletekeywords={...}              % if you want to delete keywords from the given language
}


\title{Сравнение наборов конечных элементов для стационарной задачи о каверне с подвижной верхней границей}
\date{Ноябрь 2012}
\author{Виктор Борисов}

\begin{document}

\maketitle

\section{Задача о течении в каверне}
Стационарные уравнения Стокса описывают устоявшееся несжимаемое течение в области $\Omega$ с границей $\Gamma$
\begin{equation}
-\Delta u + \nabla p = f \quad x \in \Omega,
\end{equation}
\begin{equation}
\nabla\cdot u = 0 \quad x \in \Omega,
\end{equation}
\begin{equation}
u = g \quad x \in \Gamma,
\end{equation}
где $u$ - поле скоростей, $p$ - поле давления и $f$ - внутренний источник движения.
В этой постановке присутствуют две зависимые неизвестные: скорость и давление.
В численном решении этого и вообще всех уравнений типа Навье-Стокса, используемые конечные элементы должны удовлетворять условию Ладыженской-Бабушки-Бреззи. Часто используемые полиномы Лагранжа второго порядка для давления и скорости приводят к несходимости решения.

В качестве тестовой задачи рассматривается двумерная задача о течении в каверне с подвижной верхней границей. Подвижная верхняя граница означает не изменение положения границы, а то что поле скоростей на ней имеет определенное ненулевое значение. Постановка и решение тестовой задачи не имеют физических единиц измерения. Мы рассматриваем единичный квадрат $\Omega$ (рис. \ref{fg:cavity}), c границей $\Gamma=\Gamma_t + \Gamma_w$, где на верхней границе $\Gamma_t$ поле скоростей принимает значения $u_x=1$ и $u_y=0$, в остальной части границы $\Gamma_w$ поле скоростей $u=0$ (условие неприлипания).
С добавлением таких граничных условий, уравнения принимают следующий вид:
\begin{equation}
-\Delta u + \nabla p = f \quad x \in \Omega,
\end{equation}
\begin{equation}
\nabla\cdot u = 0 \quad x \in \Omega,
\end{equation}
\begin{equation}
u = (1, 0) \quad x \in \Gamma_t,
\end{equation}
\begin{equation}
u = (0, 0) \quad x \in \Gamma_w.
\end{equation}

\begin{figure}
	\begin{center}
		\includegraphics[width=200px]{pics/cavity400}
		\caption{Тестовая область с подвижной верхней границей.}
		\label{fg:cavity}
	\end{center}
\end{figure}

\section{Конечные элементы}
Для численного решения методом конечных элементов, для начала систему уравнений переписывают в вариационную постановку:
\begin{equation}
a(u,v)-b(v,p)=(f,v) \quad \forall v \in V,
\end{equation}
\begin{equation}
b(u,q)=0 \quad \forall q \in \Pi,
\end{equation}
где 
\begin{equation}
a(u,v)=\int_\Omega \nabla v \cdot \nabla v \, dx,
\end{equation}
\begin{equation}
b(v,q)=\int_\Omega (\nabla \cdot v) q \, dx,
\end{equation}
\begin{equation}
(f,v)=\int_\Omega f \cdot v \, dx.
\end{equation}
В этой постановке множества $V$ и $\Pi$ это функциональные пространства для скорости и давления соответственно. Эти пространства состоят из конечных элементов, выбор которых влияет на качества решения. Рассматриваются три набора элементов: Taylor Hood (TH), continious discontinious Lagrange (CD), Crouzeix Raviart (CR). 

Набор TH состоит из двух полиномов Лагранжа (Lagrange) для скорости и давления. Причем порядок полинома для скорости на единицы выше чем для давления. На рис. \ref{fg:lagrange2} элемент второго порядка, для первого порядка исчезают точки по середине сторон треугольника.

Набор CD состоит из полиномов Лагранжа порядка 2 для скорости и разрывного элемента Лагранжа (Discontinuous Lagrange) порядка 0.

Набор CR это элемент Crouzeix Raviart для скорости и разрывный элемент Лагранжа порядка 0 для давления. На рис. \ref{fg:crouzeix1} представлен элемент первого порядка. Точки определяющие степени свободы расположены не на концах треугольника, а на середине сторон.

Набор TH и CD имеют максимум второй порядок, а CR первый (табл. \ref{tb:order}), что будет сказываться на свойствах решения.

\begin{figure}
	\begin{center}
		\includegraphics[width=200px]{pics/lagrange2}
		\caption{Элемент Лагранжа второго порядка.}
		\label{fg:lagrange2}
	\end{center}
\end{figure}

\begin{figure}
	\begin{center}
		\includegraphics[width=200px]{pics/crouzeix1}
		\caption{Элемент Crouzeix Raviart первого порядка.}
		\label{fg:crouzeix1}
	\end{center}
\end{figure}

\begin{table}
\begin{center}
\begin{tabular}{|c|c|c|}
\hline
Название & Скорость & Давление \\
\hline
TH & 2 & 1 \\
\hline
CD & 2 & 0 \\
\hline
CR & 1 & 0 \\
\hline
\end{tabular}
\end{center}
\caption{Порядки элементов для скорости и давления}
\label{tb:order}
\end{table}

\section{Решение}
В данном разделе описывается используемый способ сравнения решений полученных с помощью различных наборов конечных элементов. Используется функция тока, как показатель решения двумерной задачи с вычислением поля скоростей. Приводится отрывок из программы на языке Python с использованием библиотеки Fenics.

\subsection{<<Точное>> решение}
Не обладая точным решением в задаче о каверне, мы должны с чем-то сравнивать полученные результаты. Поэтому <<точным>> решением будем считать результат полученный на мелкой сетке. Все выбранные наборы элементов должны сходиться к этому <<точному>> решению при выборе мелкой сетки. Исходная область (единичный квадрат) делиться на $h^2$ квадратов, и каждый квадрат делится на два треугольника. Этот $h$ будем считать размером сетки.

За <<точное>> решение возьмем результат полученный набором TH на сетке размером $h=200$. В дальнейшем <<точное>> решение употребляется без кавычек.

\subsection{Функция тока}
В задачах с вычислением поля скоростей одним из общепринятых показателей является функция тока. Визуальное сравнение поля скоростей для двумерной задачи не очевидное, потому вместо двумерных векторов скорости - сравнивают одномерную функцию тока. Функция тока обладает следующими свойствами:
\begin{equation}
u_x = \frac{\partial \psi}{\partial y},
\end{equation}
\begin{equation}
u_y = - \frac{\partial \psi}{\partial x}.
\end{equation}
Чтобы вычислить $\psi$, надо решить уравнение Лапласа:
\begin{equation}
\Delta\psi=-\xi,
\end{equation}
где $\xi=\rot U$ - вектор вихря.

\subsection{Сравниваемые свойства наборов элементов}
Вычисляются решения на разных сетках, изменяя параметр $h$ и наборы конечных элементов указанных выше.
Нас интересует во-первых время и точность вычисления решения.

Время вычисления $t$ это количество времени потраченное на решение общей системы линейных уравнений.

Погрешность вычисления это разница между точным и текущим решениями, что такое точное решение указано выше. Погрешность для скорости $u_{err}$, давления $p_{err}$, функции тока $\psi_{err}$ мы берем следующим образом:
\begin{equation}
u_{err} = \int_{\Omega} (u_{ex} - u, u_{ex} - u) dx,
\end{equation}
\begin{equation}
p_{err} = \int_{\Omega} (p_{ex} - p, p_{ex} - p) dx,
\end{equation}
\begin{equation}
\psi_{err} = \int_{\Omega} (\psi_{ex} - \psi, \psi_{ex} - \psi) dx,
\end{equation}
где $u_{ex}$, $p_{ex}$, $\psi_{ex}$ соответствующие точные решения.

\subsection{Программа}
Программа составлена на языке Python с помощью библиотеки Fenics.
Основные параметры программы это наборы элементов:
\begin{lstlisting}
elements_table = {
    "CR": ("Crouzeix-Raviart", 1, 
                          "Discontinuous Lagrange", 0),
    "CD": ("Lagrange", 2, "Discontinuous Lagrange", 0),    
    "TH": ("Lagrange", 2, "Lagrange", 1),
}
\end{lstlisting}
где каждый набор это название элемента для скорости, порядок элемента для скорости, название элемента для давления и порядок элемента для давления. Также основными параметрами являются размеры сетки:
\begin{lstlisting}
hmin  = 25  # minimum size
hmax  = 150 # maximum size
hstep = 5   # step size
h_ex  = 200 # exact solution size
\end{lstlisting}

Возможности библиотеки Fenics позволяют довольно просто составлять процедуры решения вычислительной задачи. Область это безразмерный единичный квадрат:
\begin{lstlisting}
def create_mesh(h):
    mesh = UnitSquare(h, h)
    return mesh
\end{lstlisting}

Создание функциональных пространств, элемент и его порядок берутся из таблицы elements\_table:
\begin{lstlisting}
def create_space(element, mesh):
    (u_element, u_order, p_element, p_order) = main.elements_table[element]
    U = VectorFunctionSpace(mesh, u_element, u_order)
    P = FunctionSpace(mesh, p_element, p_order)
    W = U*P
    return W
\end{lstlisting}

Процедура решения задачи о течении в каверне: 
\begin{lstlisting}       
def solve_cavity(mesh, space):
    def domain_top(x, on_boundary):
        return on_boundary and x[1] > 1 - DOLFIN_EPS  
    def domain_walls(x, on_boundary):
        return on_boundary and x[1] < 1 - DOLFIN_EPS    
    bc0 = DirichletBC(space.sub(0), Constant((0,0)), domain_walls)
    bc1 = DirichletBC(space.sub(0), Constant((1,0)), domain_top)
    bcs = [bc0, bc1]    
    (u, p) = TrialFunctions(space)
    (v, q) = TestFunctions(space)
    f = Constant((0, 0))       
    a = inner(grad(u), grad(v))*dx - p*div(v)*dx + div(u)*q*dx
    L = inner(f, v)*dx    
    t = Timer("Solve timing");
    t.start()            
    U = Function(space)
    problem = LinearVariationalProblem(a, L, U, bcs=bcs)
    solver = LinearVariationalSolver(problem)
    solver.solve()    
    t.stop()    
    (u, p) = U.split(True)        
    # correct pressure
    c = assemble(p*dx)
    vec = p.vector()
    for i in range(vec.size()):
        vec[i] -= c
    return u, p, t.value()
\end{lstlisting}
Вложенные процедуры domain\_top и domain\_walls описывают верхнюю подвижную границы, и боковые стенки вместе с полом соответственно. После вычисления идет поправка давления, т.к. давление вычисляется с точностью до константы.

Процедура вычисления функции тока $\psi$:
\begin{lstlisting}
def solve_cavity_psi(mesh, space, u):
    V = FunctionSpace(mesh, "Lagrange", 2)
    def domain_walls(x, on_boundary):
        return on_boundary
    bc1 = DirichletBC(V, Constant(0), domain_walls)    
    bcs = [bc1]
    psi = TrialFunction(V)
    v = TestFunction(V)    
    a = inner(grad(psi), grad(v))*dx
    L = inner(-rot(u), v)*dx    
    PSI = Function(V)
    problem = LinearVariationalProblem(a, L, PSI, bcs=bcs)
    solver = LinearVariationalSolver(problem)
    solver.solve()
    return PSI
\end{lstlisting}

Процедура вычисления погрешности решения:
\begin{lstlisting}
def solve_cavity_error(u,    p,    psi,    
                       u_ex, p_ex, psi_ex, mesh_ex):
    M = inner((u_ex - u),(u_ex - u))*dx
    v_err = assemble(M, mesh=mesh_ex)    
    Mp = (p_ex - p)*(p_ex - p)*dx
    p_err = assemble(Mp, mesh=mesh_ex)
    Mps = (psi_ex - psi)*(psi_ex - psi)*dx
    psi_err = assemble(Mps, mesh=mesh_ex)
    return (v_err, p_err, psi_err)
\end{lstlisting}
Происходит сравнение с точными решениями u\_ex, p\_ex, psi\_ex.

\section{Результаты}
В результате вычисления получаем функции u, p, psi определенные на выбранных наборах конечных элементов и сетки. Естественно, что на более грубой сетки вычисляемое значения функции, если не попадает в узел, интерполируется. Для сравнения полученных результатов, для полученных функций вычисляются все значения на сетке mesh\_ex и сохраняются в файле в формате, который понимает программа для графиков Gnuplot.

\subsection{Графики}
\begin{figure}
	\begin{center}
		\includegraphics[width=400px]{pics/time}
		\caption{Зависимость времени вычисления от размера области для наборов элементов CR, TH, CD.}
		\label{fg:time}
	\end{center}
\end{figure}

\begin{figure}
	\begin{center}
		\includegraphics[width=400px]{pics/u_err}
		\caption{Зависимость погрешности скорости от размера области для наборов элементов CR, TH, CD.}
		\label{fg:u_err}
	\end{center}
\end{figure}

\begin{figure}
	\begin{center}
		\includegraphics[width=400px]{pics/p_err}
		\caption{Зависимость погрешности давления от размера области для наборов элементов CR, TH, CD.}
		\label{fg:p_err}
	\end{center}
\end{figure}

\begin{figure}
	\begin{center}
		\includegraphics[width=400px]{pics/psi_err}
		\caption{Зависимость погрешности функции тока от размера области для наборов элементов CR, TH, CD.}
		\label{fg:psi_err}
	\end{center}
\end{figure}

\begin{figure}
	\begin{center}
		\includegraphics[width=400px]{pics/psi_25}
		\caption{Функция тока на разрезе по $x=0.5$ при $h=25$ для наборов элементов CR, TH, CD. Линия EX - точное решение.}
		\label{fg:psi_25}
	\end{center}
\end{figure}

\begin{figure}
	\begin{center}
		\includegraphics[width=400px]{pics/psi_50}
		\caption{Функция тока на разрезе по $x=0.5$ при $h=50$ для наборов элементов CR, TH, CD. Линия EX - точное решение.}
		\label{fg:psi_50}
	\end{center}
\end{figure}

\begin{figure}
	\begin{center}
		\includegraphics[width=400px]{pics/psi_100}
		\caption{Функция тока на разрезе по $x=0.5$ при $h=100$ для наборов элементов CR, TH, CD. Линия EX - точное решение.}
		\label{fg:psi_100}
	\end{center}
\end{figure}

\begin{figure}
	\begin{center}
		\includegraphics[width=400px]{pics/psi_150}
		\caption{Функция тока на разрезе по $x=0.5$ при $h=150$ для наборов элементов CR, TH, CD. Линия EX - точное решение.}
		\label{fg:psi_150}
	\end{center}
\end{figure}

\newpage
\subsection{Выводы}
Применять только наборы элементов Taylor-Hood. Они супер-круты.

\end{document}